# GitOps Configuration for MLOps Platform
# This file defines the GitOps workflow using GitHub Actions and AWS

apiVersion: v1
kind: GitOpsConfig
metadata:
  name: mlops-platform-gitops
  environment: dev

# GitHub Configuration
github:
  repository: your-org/mlops-platform
  branch: main
  workflows:
    - name: ci-cd
      path: .github/workflows/ci-cd.yml
    - name: deploy
      path: .github/workflows/deploy.yml
    - name: test
      path: .github/workflows/test.yml

# AWS Configuration
aws:
  region: us-east-1
  account_id: "123456789012"
  
  # Resources managed by GitOps
  resources:
    - type: lambda
      functions:
        - mlops-platform-training-handler-dev
        - mlops-platform-inference-handler-dev
        - mlops-platform-model-registry-handler-dev
    
    - type: sagemaker
      endpoints:
        - medication-adherence-model-endpoint
    
    - type: glue
      jobs:
        - mlops-platform-data-validation-dev
        - mlops-platform-data-preprocessing-dev

# Deployment Strategy
deployment:
  strategy: blue-green
  approval_required: true
  environments:
    - name: dev
      auto_deploy: true
    - name: staging
      auto_deploy: false
      approval_required: true
    - name: prod
      auto_deploy: false
      approval_required: true
      rollback_enabled: true

# Monitoring
monitoring:
  cloudwatch:
    enabled: true
    log_groups:
      - /aws/lambda/mlops-platform-*
      - /aws/sagemaker/*
      - /aws/glue/*
  
  alerts:
    - name: deployment-failure
      condition: deployment_status == 'failed'
      action: rollback
    
    - name: high-error-rate
      condition: error_rate > 5%
      action: notify

# GitOps Sync
sync:
  interval: 5m
  prune: true
  self_heal: true
  
  # What to sync from Git
  sources:
    - path: infrastructure/
      target: cloudformation
    - path: backend/lambda/
      target: lambda
    - path: glue-scripts/
      target: glue
